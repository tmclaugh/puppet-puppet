# $Id$

class postfix::local ($smarthost) {
	include postfix::common
	
	service { "postfix" :
		ensure => true,
		enable => true,
		subscribe => [File["$postfix::params::master_cf"],
				File["$postfix::params::main_cf"],
				Exec["smart_host"]]
	}

	exec { "smart_host" :
		# XXX: Yeah, command sucks but works for a new host.
		command => "sed -i -e '/^#$/,/^#relayhost/ {s/#\(relayhost\).*\\\$mydomain/\\1 = ${smarthost}/}' $postfix::params::main_cf",
		unless => "grep 'relayhost' '${postfix::params::main_cf}' | grep '^relayhost'",
		require => File[$postfix::params::main_cf],
	}
}
