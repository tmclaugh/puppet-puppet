# $Id$


class straycat::sec::os::centos5 {
	$pam_grps = "/etc/pam_allowed_groups.conf"
	$pam_system_auth = "/etc/pam.d/system-auth-ac"

	package { "pam_krb5" :
		ensure => present,
		require => Class["krb5::client"]
	}

	file { $pam_system_auth :
		owner => root,
		group => root,
		mode => 644,
		source => "puppet:///modules/straycat/system-auth-ac"
	}

	file { "/etc/pam.d/system-auth" : 
		ensure => symlink,
		target => "/etc/pam.d/system-auth-ac",
		require => File[$pam_system_auth]
	}

	#define pam_login ($userslist) {
	#	file { "/etc/pam_allowed_groups.conf" :
	#		owner => root,
	#		group => root,
	#		mode => 644,
	#		content => template("auth/pam_allowed_groups.conf"),
	#	}
	#}

	define sudoers_all {
		# XXX: Tried using '\s' in the match line but puppet did not play
		# well with that.

		append_if_no_match { "sudoers_${name}" :
			file => $sudo::sudoers,
			line => "\n%${name} ALL=(ALL)\tALL",
			match => "%${name}.*ALL=\(ALL\).*ALL",
			require => Class["sudo"],
		}
	}

	#pam_login{ "users" : userslist => $usergrps }
	#sudoers_all{ $admingrps : }
}

