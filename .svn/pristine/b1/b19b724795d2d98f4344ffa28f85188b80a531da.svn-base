#!/bin/sh
#
# $Id$
#
# Add our IP info to the hosts file because Samba requires it for some
# reason to properly join the domain.

if [ x"$new_ip_address" != x ]; then
        h=$(hostname)

	# Handle host renaming
	if cat /etc/hosts | grep $new_ip_address | grep -v $h > /dev/null 2>&1 ; then
                sed -i "/$new_ip_address/d" /etc/hosts
        fi
        

	# NOTE: name resolution should work now.
	fqdn=$(hostname -f)
        if cat /etc/hosts | grep '$fqdn' > /dev/null 2>&1 ; then
                sed  -i "s/^.*$fqdn.*/$new_ip_address $fqdn $h/" /etc/hosts
        else
                echo $new_ip_address $fqdn $h >> /etc/hosts
        fi
fi
